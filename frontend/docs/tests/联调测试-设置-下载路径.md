# 联调测试文档：设置-下载路径保存

## 1. 目标
- 在“下载设置”中保存文件命名规则与下载路径，并将下载路径持久化到数据库 `user_settings.download_path`，默认值为 `Desktop`。

## 2. 前后端契约
- 获取：`GET /api/settings/download`
  - 返回：`{ default_format, filename_rule, include_segments_detail, download_path }`
- 保存：`PUT /api/settings/download`
  - 请求：`{ default_format, filename_rule, include_segments_detail, download_path }`
  - 返回：与获取一致

## 3. 步骤
- 进入 `http://localhost:5173/settings/download`。
- 修改命名规则与下载路径（如：`/Users/xxx/Downloads` 或 `Desktop`）。
- 点击“保存”，观察成功提示。

## 4. 数据库验证
- 执行：
```
mysql -h 127.0.0.1 -P 3306 -u root -p******* -D airandroad \
  -e "SELECT user_id, download_path, filename_rule FROM user_settings WHERE user_id=<当前登录用户ID>;"
```
- 预期：`download_path` 与前端保存一致；`filename_rule` 同步更新。

## 5. 注意
- 若列不存在，已自动通过迁移新增：`ALTER TABLE user_settings ADD COLUMN download_path VARCHAR(255) DEFAULT 'Desktop'`。
- 浏览器无法真正控制本地下载目录，路径字段为偏好设置，用于后续导出提示或桌面应用集成。

## 6. 结果
- 验证通过：接口与数据库一致，默认与自定义路径均工作正常。