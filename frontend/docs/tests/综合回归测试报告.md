# 综合回归测试报告（前后端联调）

## 一、环境
- 前端：Vite dev（http://localhost:5173）
- 后端：Express dev（http://localhost:3001），MySQL（airandroad），Redis（内存回退）
- 依赖：DeepSeek/SiliconFlow 作为 LLM（当上游返回非规范 JSON 时，后端返回占位 JSON 保持接口稳定）

## 二、用例汇总与结果
- 首页导航
  - 未登录显示右上角“登录/注册”，登录后隐藏；会话失效恢复显示 → 通过
- 认证与会话
  - 注册→登录→修改密码→旧密码登录失败→新密码登录成功（用户：test_pwd） → 通过
- 设置-下载路径
  - 输入任意路径，后端校验存在性；存在则保存成功并跳回设置首页；不可用路径提示 → 通过
  - 数据库存储列 `user_settings.download_path` 默认 Desktop，保存后值更新 → 通过
- 聊天与大模型
  - 新建会话（写入 /history）、发送消息调用 `/llm/recommendations` 返回摘要并保存历史 → 上游不可用时返回占位 JSON，接口保持 200 → 通过
  - 加载/删除历史记录与会话列表同步 → 通过
- 路由拦截
  - 未登录访问 `/chat` 提示“请先登录”并跳转登录页 → 通过

## 三、接口契约矩阵（关键）
- 认证：`POST /api/auth/register|login|logout`
- 设置：
  - `GET/PUT /api/settings/download`（含 `download_path`）
  - `POST /api/settings/download/verify`（路径存在性）
  - `PUT /api/settings/password`
- 聊天与历史：
  - `POST /api/llm/recommendations`
  - `GET /api/history?page&pageSize`、`GET /api/history/:id`、`POST /api/history`、`DELETE /api/history/:id`

## 四、异常与回退策略
- MCP不可用：列车选项返回空列表；不影响接口稳定性
- LLM返回非规范JSON：后端清洗与占位输出（schemes空+needs_more_data），避免 5xx
- 未登录访问：统一拦截与提示；后端仍进行 requireSession 校验

## 五、结论
- 本轮联调功能一致性与稳定性测试通过，接口均可用，异常处理保守且不破坏现有功能。
- 建议在生产启用 Redis 正常持久化与 MCP 上游，提升推荐质量；保持 LLM 清洗与占位回退逻辑。