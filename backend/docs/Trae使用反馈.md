# Trae 编译器使用反馈（AI 助手驱动）

## 概览

- 项目：后端 `/Users/linzhichao/Desktop/airAndroad/backend`，前端 `/Users/linzhichao/Downloads/travel_helper/travel_helper`
- 运行端口：后端 `3001`，前端 `5173/5174`
- 本次工作内容：后端提示词强化、MCP/REST 联调、两部分方案结构化输出、前端 UI 与性能优化、页面背景视觉增强、服务重启与验证。

## 使用体验（优点）

- 文件级操作高效：支持精确读取与补丁变更，适合快速迭代（如 `src/llm/deepseek.ts`、`src/views/Chat.vue`）。
- 终端管理便利：可并行启停前后端服务，并获取端口占用与健康检查（`/api/metrics` 200）。
- 返回结果可验证：通过接口探测与预览地址，快速闭环开发→验证→优化。
- 上下文保持良好：跨多步骤仍能聚合先前的操作与输出，适合长链路联调与提示词迭代。

## 问题与现象（需持续优化）

- 端口占用：后端重启时出现 `EADDRINUSE :3001`，需要强制停止旧进程后再启动。
- 终端状态一致性：偶发出现终端非空闲导致新命令被强制接管或报错，需要更清晰的状态提示与自动切换机制。
- 前端端口切换：当 `5173` 被占用时自动切换为 `5174`，但预览链接需要同步提示到用户界面。
- 自检接口并发：在频繁重启阶段，健康检查与服务起停存在短暂竞态，建议健康检查延时或重试策略。

## 关键改动与产出

- 提示词强化：后端 LLM 提示词明确角色为“智能旅行票务分析师”，聚合 12306 MCP + `c_trip_data_new`，只返回两部分 JSON（时间/价格），严禁模糊价格。
- 结构化输出：前端统一两部分方案卡片结构（或 Markdown 输出），分段列车/航班、购票链接、风险提示。
- MCP/REST 联调：当 MCP 不可用时走 REST 回退（文本搜索、周边、地理/逆地理、距离、路径、公交综合），保证功能可用性。
- 性能优化：并行拉取推荐与编排数据、前端查询缓存（`origin|destination|date`），兜底生成两部分方案，减少空响应。
- UI 增强：聊天页加入风景背景与半透明气泡，提升视觉体验；首页标题更新为 Travel Parity 艺术风格。

## 最佳实践（总结）

- 重启前先清理旧进程：统一执行停止命令，再启动后端与前端；健康检查建议延时 1–2 秒。
- 接口兜底：当航班库近十天无数据时，不造价，使用公交综合 cost/duration 构造两部分方案，明确标注缺失来源。
- 目的地过滤：酒店与 POI 强制按目的地行政区或地址字符串过滤，距离字段仅在有效时展示。
- Markdown 输出：推荐类回答统一以 Markdown 分层（标题/列表/链接/提示），确保结构化可读。

## 建议（面向工具与流程）

- 终端冲突提示：在端口占用或终端非空闲时，提供自动停止旧进程选项与更显眼的提示。
- 预览链接联动：前端端口切换（如 5173→5174）时，自动更新并提示预览地址。
- 健康检查策略：为服务起停增加重试与退避，减少短暂的连接失败噪音。
- 变更预览：在补丁应用后自动生成变更摘要，便于审核与回滚。

## 运行验证（当前）

- 后端健康：`GET http://localhost:3001/api/metrics` → 200
- 前端首页：`GET http://localhost:5173/` → 200
- MCP 时段查询：广州→北京（明天）返回多趟 G/Z/D 车次与时段，结构化展示正常。

---

本反馈旨在促进与 Trae 编译器的协同友好，提升端到端联调效率与稳定性。后续如需将 Markdown 生成统一下沉至后端或加入 CI 自动化验证，可继续迭代。